## Structural images

This directory contains python scripts and the resulting text files with PyMol commands that can be run to generate structural views and alignments for various figures and analyses.

- The file [surface_constraint_features.pse](surface_constraint_features.pse) was copied from the [SARS-CoV-2-RBD_DMS repository](https://github.com/jbloomlab/SARS-CoV-2-RBD_DMS).
It was originally constructed from a set of `pdb` structures in the `data` subdirectory and the output `pdb` files from the `structure_function.Rmd` script, which replaces the RBD b factor column with the mean mutational effects per site from our DMS measurements.

- The script [write_pymol_commands.py](write_pymol_commands.py) takes a list of antibodies and a set of PDB files in the [../results/pdb_outputs/](../results/pdb_outputs/) directory generated by [output_pdbs.Rmd](../output_pdbs.Rmd) notebook, in which the b factor has been replaced by escape fractions for each antibody.
It outputs the next text file:

- The commands in [pymol_commands.txt](pymol_commands.txt) can be run in the `surface_constraint_features.pse` PyMol session to generate a *new* `.pse` file, [surface_escape.pse](surface_escape.pse) that includes an object for each RBD antibody escape profile, with the surface colored by the max `escape_frac` for a mutation at each site.
This is colored from white to red, where the strongest escape mutations are colored red.
These commands also re-color the `RBD_bind` and `RBD_expression` objects on a blue to white scale (rather than the original red to white), such that any site with mean mutational effect less than or equal to -2 is the darkest blue, and mean effects from -2 to zero scale from blue to white.
This is to avoid confusion with the antibody escape profiles, which are scaled white to red.
